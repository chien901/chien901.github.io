<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/reset.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
        integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous">

    <title>Hello, world!</title>

    <style>
        .box {
            width: 1024px;
            margin: auto;
        }

        .info-pic {
            height: 20px;
            width: 20px;
            font-size: 10px;
        }

        .apparence {
            font-size: 10px;
        }

        .btn-outline-secondary {
            border-radius: 12px;
            border: 1px solid #ccc;
            color: #000;
            font-size: 10px;
        }

        .btn-outline-secondary:hover {
            background-color: #fff;
            color: #000;
        }

        [data-bs-toggle="modal"] {
            border-radius: 20px;
            font-size: 10px;
        }

        .modal-content {
            border-radius: 20px;
            overflow: hidden;
        }

        .ps,
        .modal-footer,
        .consult {
            font-size: 10px;
        }

        .modal-footer a,
        .consult a {
            text-decoration: none;
            color: #0a58ca;
        }

        .modal-footer a:hover,
        .consult a:hover {
            text-decoration: underline;
        }

        li {
            list-style: disc;
            margin-bottom: 10px;
        }

        .accordion-button:focus,
        .cap-btn:focus,
        .cap-btn:focus:active {
            border: none;
            box-shadow: none;
        }

        .accordion-button:not(.collapsed) {
            color: #212529;
            background: #fff;
            box-shadow: none;
        }

        .fa-circle {
            font-size: 32px;
        }
    </style>
</head>

<body>
    <div class="box mt-5">
        <section class="product-select row">
            <div class="apparence col-6 text-center fw-bold">
                <div class="row position-sticky top-0">
                    <div class="col-12 p-5">
                        <img src="/iPad/iPad_pic/ipad-air-select-202009.jfif" class="apparence-pic w-100"
                            alt="iPad Air">
                    </div>
                    <div class="col-4 p-1">
                        <img src="/iPad/iPad_pic/deliver.svg" alt="deliver">
                        <p>免額外付費的運送服務</p>
                    </div>
                    <div class="col-4 p-1">
                        <img src="/iPad/iPad_pic/engraved.svg" alt="engraved">
                        <p>免額外付費的個人化鐫刻服務</p>
                    </div>
                    <div class="col-4 p-1">
                        <img src="/iPad/iPad_pic/return.svg" alt="return">
                        <p>免額外付費輕鬆退貨</p>
                    </div>
                </div>
            </div>
            <div class="col-6 accordion accordion-flush" id="menu">
                <h2 class="fw-bold mb-5">購買 iPad Air</h2>
                <div class="accordion-box"></div>
                <div class="checkout bg-light">
                    <p class="final-price fs-3 fw-bold p-4">NT$18900 起</p>
                </div>
                <div class="consult row justify-content-lg-center">
                    <div class="pic col-1">
                        <img src="/iPad/iPad_pic/QA.svg" alt="Q&A">
                    </div>
                    <div class="text col-5 mb-5">
                        <p class="fw-bold m-0">有任何關於購買 iPad 的問題嗎？</p>
                        <a href="#">與 iPad 專員對談</a>
                    </div>
                </div>

            </div>
        </section>
    </div>
    <div class="modal fade" id="Modal" tabindex="-1" aria-labelledby="ModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header border-bottom-0">
                    <button type="button" class="btn-close ms-0 btn-lg" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body ps-5 pe-5">
                </div>
                <div class="modal-footer flex-column bg-light border-top-0">
                    <div class="pic">
                        <img src="/iPad/iPad_pic/QA.svg" alt="Q&A">
                    </div>
                    <p class="fw-bold">有任何關於購買 iPad 的問題嗎？</p>
                    <a href="#">與 iPad 專員對談</a>
                </div>
            </div>
        </div>
    </div>

    <template id="accordion-item">
        <div class="accordion-item border-top-0">
            <h3 class="accordion-header" id="flush-headingOne">
                <button class="accordion-button fw-bold" type="button" data-bs-toggle="collapse" aria-expanded="true">
                </button>
            </h3>
            <div class="accordion-collapse collapse show" aria-labelledby="flush-headingOne">
                <div class="accordion-body row">
                </div>
            </div>
        </div>
    </template>
    <template id="selectBtn">
        <div class="col-6 p-2">
            <button type="button" class="select-btn btn btn-outline-secondary text-center p-4 lh-lg w-100">
                <div class="m-auto fs-5 fw-bold"></div>
                <div class="m-auto"></div>
            </button>
        </div>
    </template>
    <template id="capModalBtn">
        <div class="col-12 p-2">
            <button type="button" class="cap-btn btn btn-light d-flex text-start  align-items-center w-100"
                data-bs-toggle="modal" data-bs-target="#Modal">
                <p class="col-11 p-2 m-0"></p>
                <div class="col-1 info-pic rounded-circle border border-2 border-primary text-center ">
                    <i class="fas fa-info text-primary bg-light"></i>
                </div>
            </button>
        </div>
    </template>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
        </script>
    <script>
        const apparencePic = document.querySelector('.apparence-pic')
        const accordionBox = document.querySelector('#menu .accordion-box')
        const accordionItem = document.querySelector('#accordion-item')
        const selectBtn = document.querySelector('#selectBtn')
        const capModalBtn = document.querySelector('#capModalBtn')
        const modalBody = document.querySelector('.modal-body')
        const finalPrice = document.querySelector('.final-price')
        const dataUrl = '/iPad/iPad_products.json'

        window.onload = function () {
            setData()
        }

        function setData() {
            fetch(dataUrl).then(respone => respone.json()).then(result => {
                result.forEach((item, index) => {
                    let cloneAI = accordionItem.content.cloneNode(true)
                    let accordionButton = cloneAI.querySelector('.accordion-button')
                    let accordionCollapse = cloneAI.querySelector('.accordion-collapse')
                    accordionButton.innerText = item.title
                    accordionButton.setAttribute('data-bs-target', `#flush-collapse${index}`)
                    accordionCollapse.id = `flush-collapse${index}`
                    let btnBox = cloneAI.querySelector('.accordion-body')

                    if (index > 0) {
                        accordionButton.disabled = true
                    }
                    if (item.caption) {
                        let cloneCBtn = capModalBtn.content.cloneNode(true)
                        let capBtn = cloneCBtn.querySelector('.btn')
                        let capText = capBtn.querySelector('p')
                        capText.innerHTML = item.caption
                        btnBox.append(cloneCBtn)
                        if (index > 0) {
                            capBtn.disabled = true
                        }

                        capBtn.onclick = function () {
                            modalBody.innerHTML = ''
                            item.modal.forEach(mt => {
                                let h4 = document.createElement('h4')
                                h4.innerText = mt.title
                                h4.classList.add('fs-1', 'fw-bold', 'text-center')
                                modalBody.append(h4)
                                mt.content.forEach(cont => {
                                    let p = document.createElement('p')
                                    p.innerHTML = cont
                                    modalBody.append(p)
                                })
                                mt.ps.forEach(ps => {
                                    let p = document.createElement('p')
                                    p.innerText = ps
                                    p.classList.add('ps', 'text-secondary')
                                    modalBody.append(p)
                                })

                            })
                        }
                    }

                    item.type.forEach(btn => {
                        let cloneSBtn = selectBtn.content.cloneNode(true)
                        let sBtn = cloneSBtn.querySelector('.btn')
                        let btnText = sBtn.querySelectorAll('div')
                        btnText[0].innerHTML = btn.spec
                        btnText[1].innerText = btn.instruction
                        btnBox.append(cloneSBtn)
                        if (index > 0) {
                            sBtn.disabled = true
                        }

                        sBtn.onclick = function () {
                            accordionButton.innerText = btnText[0].firstChild.nodeName == '#text' ? btnText[0].innerText : btnText[1].innerText
                            accordionButton.click()
                            if (btn.productPic) {
                                apparencePic.src = `/iPad/iPad_pic/${btn.productPic}`
                            }
                            if (accordionBox.querySelectorAll('.accordion-item')[index + 1]) {
                                let nextAI = accordionBox.querySelectorAll('.accordion-item')[index + 1]
                                nextAI.querySelectorAll('button').forEach(nbtn => {
                                    nbtn.disabled = false
                                })
                                if (btn.price) {
                                    nextAI.querySelectorAll('.select-btn').forEach((sbtn, idx) => {
                                        sbtn.querySelector('div:nth-of-type(2)').innerText = `NT$${btn.price[idx]}`
                                    })
                                }
                            }
                            if (btn.price) {
                                finalPrice.innerText = btnText[1].innerText
                            }
                        }
                    })
                    accordionBox.append(cloneAI)

                })

            })
        }

    </script>

</body>

</html>